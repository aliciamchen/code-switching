---
title: "pilot 1"
author: "Alicia Chen"
date: "2024-09-17"
output:
  html_document: default
---

```{r setup, include=FALSE}
library(here)
library(tidyverse)
library(tidyboot)

theme_set(theme_classic(base_size = 20))
```

# Selection trials

```{r}
selection_trials <- read_csv(here("analysis", "pilot-1_2024-09-17", "selection_trials.csv"))
```
Main trials (different tangrams shown): Are there differences between refer and social goals?

Prediction: for "refer" goals, people should equally choose between the two tangrams. For the "social" goals, people should choose the unique tangram

```{r}
selection_trials_means <- selection_trials %>%
  mutate(response.shared = if_else(response.shared == "shared", 1, 0)) %>%
  group_by(type, goal) %>%
  tidyboot_mean(response.shared, na.rm = T)

selection_trials_means
```

Plot means aggregated across participants

```{r}
filtered_trials <- selection_trials %>%
  mutate(response.shared = if_else(response.shared == "shared", 1, 0)) %>%
  filter(type == "diff")

filtered_means <- selection_trials_means %>%
  filter(type == "diff")

ggplot(filtered_trials, aes(x = goal, y = response.shared, fill = goal)) +
  geom_jitter(size = 3, stroke = 0, width = 0.15, height = 0.1, alpha = 0.3) +
  geom_point(data = filtered_means, aes(x = goal, y = empirical_stat), size = 3, fill = "black", inherit.aes = FALSE) +
  geom_errorbar(data = filtered_means, aes(x = goal, ymin = ci_lower, ymax = ci_upper), size = 1.5, width = 0.05, inherit.aes = FALSE) +
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "shared or unique label", title = "different tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("unique", "shared")) +
  theme(legend.position = "none")
```

It seems like, regardless of the goal, people choose the unique tangram. 

## Plot slopes per participant

```{r}
selection_trials_means_participant <- selection_trials %>%
  filter(type == "diff") %>% 
  mutate(response.shared = if_else(response.shared == "shared", 1, 0)) %>%
  group_by(subject_id, type, goal) %>%
  tidyboot_mean(response.shared, na.rm = T)
```

```{r}
ggplot(selection_trials_means_participant, aes(x = goal, y = empirical_stat, group = subject_id)) +
  geom_point(position = position_dodge(width = 0.15), size = 2, fill = "black", alpha = 0.7) +
  geom_line(position = position_dodge(width = 0.15), alpha = 0.5) +
  geom_errorbar(aes(x = goal, ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = 0.15), size = 1.4, width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "shared or unique label", title = "different tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("unique", "shared")) +
  theme(legend.position = "none")
```


## Control trials: choosing between the same tangram

For the "refer" goal, people should choose the seen label over the unseen label

```{r}
control_trials_refer <- selection_trials %>% 
  filter(type == "same", goal == "refer") %>% 
  mutate(seen = ifelse(response.group == "unseen", 0, 1)) 

control_trials_refer.means <- control_trials_refer %>% 
  tidyboot_mean(seen, na.rm = T) %>% 
  mutate(goal = "refer")
```

```{r fig.width=3, fig.height=4}
ggplot(control_trials_refer, aes(x = goal, y = seen)) +
  geom_jitter(size = 3, stroke = 0, width = 0.15, height = 0.1, alpha = 0.3) +
  geom_point(data = control_trials_refer.means, aes(x = goal, y = empirical_stat), size = 3, fill = "black", inherit.aes = FALSE) +
  geom_errorbar(data = control_trials_refer.means, aes(x = goal, ymin = ci_lower, ymax = ci_upper), size = 1.5, width = 0.05, inherit.aes = FALSE) +
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "seen or unseen label", title = "same tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("unseen", "seen")) +
  theme(legend.position = "none", plot.title = element_text(size = 15))
```

For the "social" goal, people should choose the tangram belonging to the audience group

```{r}
control_trials_social <- selection_trials %>% 
  filter(type == "same", goal == "social") %>% 
  mutate(audience_group = ifelse(audience == response.group, 1, 0))

control_trials_social.means <- control_trials_social %>%
  tidyboot_mean(audience_group, na.rm = T) %>% 
  mutate(goal = "social")
```

```{r fig.width=3, fig.height=4}
ggplot(control_trials_social, aes(x = goal, y = audience_group)) +
  geom_jitter(size = 3, stroke = 0, width = 0.15, height = 0.1, alpha = 0.3) +
  geom_point(data = control_trials_social.means, aes(x = goal, y = empirical_stat), size = 3, fill = "black", inherit.aes = FALSE) +
  geom_errorbar(data = control_trials_social.means, aes(x = goal, ymin = ci_lower, ymax = ci_upper), size = 1.5, width = 0.05, inherit.aes = FALSE) +
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "label belongs to audience grp", title = "same tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("no", "yes")) +
  theme(legend.position = "none", plot.title = element_text(size = 15))
```


### Break down by participant

```{r}
control_trials_refer.means.participant <- control_trials_refer %>% 
  group_by(subject_id) %>% 
  tidyboot_mean(seen, na.rm = T) %>% 
  mutate(goal = "refer")

control_trials_social.means.participant <- control_trials_social %>%
  group_by(subject_id) %>% 
  tidyboot_mean(audience_group, na.rm = T) %>% 
  mutate(goal = "social")
```

```{r}
ggplot(control_trials_refer.means.participant, aes(x = goal, y = empirical_stat, group = subject_id)) +  
  geom_point(position = position_dodge(width = 0.2), size = 2, fill = "black", alpha = 0.7) +  # widen the dodge to 0.3
  geom_errorbar(aes(x = goal, ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = 0.2), size = 1.5, width = 0.05) +  # same dodge width for error bars
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "seen or unseen label", title = "same tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("unseen", "seen")) +
  theme(legend.position = "none", plot.title = element_text(size = 15))
```

```{r}
ggplot(control_trials_social.means.participant, aes(x = goal, y = empirical_stat, group = subject_id)) +  
  geom_point(position = position_dodge(width = 0.2), size = 2, fill = "black", alpha = 0.7) +  # widen the dodge to 0.3
  geom_errorbar(aes(x = goal, ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = 0.2), size = 1.5, width = 0.05) +  # same dodge width for error bars
  geom_hline(yintercept = 0.5, color = "red", linetype = "dashed") +
  labs(x = "goal", y = "seen or unseen label", title = "same tangrams") +
  scale_y_continuous(breaks = c(0, 1), labels = c("unseen", "seen")) +
  theme(legend.position = "none", plot.title = element_text(size = 15))
```




# Exit survey

```{r}
exit_survey <- read_csv(here("analysis", "pilot-1_2024-09-17", "exit_survey.csv"))
```

What feedback did participants give?

```{r}
exit_survey$feedback
```

